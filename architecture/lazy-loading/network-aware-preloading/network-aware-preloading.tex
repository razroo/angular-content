\chapter{ Network Aware Predictive Pre-Loading }

Pre-loading is a strategy baked into the router in Angular, that allows for
modules to pre-loaded when it becomes available. Lazy loading modules, allows 
for modules to be optimized, so that the initial load, only includes the page 
the user is navigating to. This helps to decrease the initial load time. 
However, depending on how expensive including a module is, pre-loading can
save you time. 

\section{ Being Aware of How Much Time Pre-Loading Saves }
You might be curious as to how much time is actually saved with regards to 
pre-loading? I was curious as well. I tried personally, and the amount of 
time saved, to be honest, is negligable. However, I also realize that the 
app I am working on has a minimal amount of modules. I can see that for 
another app, wherein there are multiple modules that are loaded. Therefore, 
let's throw out an arbitrary number. If you have a module that is going to 
use more than 20 imports inside of it's module, then worry about a pre-loading 
strategy. That being said, it is something that you should be aware of, and
here is how to go around following that strategy. 

\section{Pre-Load Everything}
While this strategy will rarely work for any real-world application, there is 
an option to pre-load everything in Angular. To do so, you would do something 
such as the following: 
\begin{lstlisting}
import { RouterModule, PreloadAllModules } from '@angular/router';

@NgModule({
  imports: [
    RouterModule.forRoot(routes, {
      preloadingStrategy: PreloadAllModules,
    }),
  ],
})
class AppRoutingModule {}
\end{lstlisting}

However, what does make more sense, in an enterprise setting, is custom pre-loading
modules. That is, pre-load the more expensive modules, and not pre-load those that 
are less expensive. In addition, make the pre-loading happen at a time more 
convenient for the app. Let's dive into what that means.

\section{ Custom Pre-Loading }
Angular offers the ability to pre-load content. It offers a \lstinline{preload}
method that takes two arguments: 
\begin{enumerate}
  \item route - Route object to tap into, for the load function.
  \item load - Function when run, triggers the module being loaded
\end{enumerate}

\subsection{General Strategy}
If we wanted to pre-load some modules, and did not want to pre-load others, we
would follow the following strategy:
\begin{enumerate}
  \item Give our route some unique data(i.e. \lstinline{preload: true})
   to be used within our custom pre-loading function.
  \item Create custom pre-loading function, that makes use of our unique data. 
  \item Pass in custom pre-loading as a provider to the \lstinline{preloadingStrategy} 
  key.
\end{enumerate}

\subsection{Strategy Exemplified in Code}
\subsubsection{Give Route Unique Data}
\begin{lstlisting}[caption=app.routing.module.ts]
import { NgModule } from '@angular/core';
import { RouterModule } from '@angular/router';

@NgModule({
  imports: [
    RouterModule.forRoot(
      [
        {
          path: 'books',
          loadChildren: () =>
            import('@razroo/razroo/books').then(
              module => module.RazrooBooksModule
            ),
          data: { preload: true }
        },
        {
          path: 'consulting',
          loadChildren: () =>
            import('@razroo/razroo/consulting').then(
              module => module.RazrooConsultingModule
            )
        },
      ],
      {
        initialNavigation: 'enabled',
        relativeLinkResolution: 'corrected'
      }
    )
  ],
  exports: [RouterModule]
})
export class RazrooAppRoutingModule {}
\end{lstlisting}

\subsubsection{Custom Function For Pre-Loading}
\begin{lstlisting}[caption=custom-preloading.ts]
export class PreloadSelectedModulesList implements PreloadingStrategy {
  preload(route: Route, load: Function): Observable<any> {
    return route.data && route.data.preload ? load() : of(null);
  }
}
\end{lstlisting}

It is worthwhile to note that Razroo put's the \lstinline{custom-preloading.ts} 
util file in the \lstinline{libs/common/utils} folder.

\subsubsection{Pass in custom pre-loading as a Provider}
\begin{lstlisting}[caption=app.routing.module.ts]
  import { NgModule } from '@angular/core';
  import { RouterModule } from '@angular/router';
  import { PreloadSelectedModulesList } from '@razroo/common/ui/utils';
  
  @NgModule({
    imports: [
      RouterModule.forRoot(
        [
          // ...routes go here
        ],
        {
          preloadingStrategy: PreloadSelectedModulesList
          //...
        }
      )
    ],
    exports: [RouterModule]
  })
  export class RazrooAppRoutingModule {}
  \end{lstlisting}

\section{Enabling Module Pre-loading on Custom Event}
If we would like to extend the pre-loading architecture one step further, 
tying in custom events with custom pre-loading, will make things even 
more efficient. In particular, when a user hovers over a navigation menu item, 
we can pre-load a module. 

\subsection{General Strategy}
The general strategy will look very similar to custom pre-loading. 
There are two differences. In our \lstinline{custom-preload} util function,
we will be adding an observable. Why an observable you might ask? Well, 
that observable is going to be used within our \lstinline{custom-preload} util 
function. 




