\chapter{ Testing Cypress Locally With Authentication }

In any real world application, there is going to be the need to add authentication to your application. In real world application, this translates to a login process, to verify you are, who you say you are. 

The difficulty with this, is that all enterprise organizations re-direct the user to an alternate link to log in. After user log's in with username and password, this individual will then be re-directed to appropriate app. This re-direct will trigger a CORS issue. The error usually looks something like the following: 
\begin{verbatim}
CypressError: Cypress detected a cross origin error happened on page load:

Blocked a frame with origin "url" from accessing a cross-origin frame.
\end{verbatim}

If you want to test locally, and see your updates in real time, you will need to get around this CORS issue. 

\section{Steps to Solve Cors Issue}
\begin{enumerate}
\item Add the following to your \lstinline{plugins/index.js} file
\begin{lstlisting}   
module.exports = (on, config) => {
  on('before:browser:launch', (browser = {}, args) => {
    console.log(config, browser, args);
    if (browser.name === 'chrome') {
      args.push("--disable-features=CrossSiteDocumentBlockingIfIsolating,CrossSiteDocumentBlockingAlways,IsolateOrigins,site-per-process");
      args.push("--load-extension=cypress/extensions/Ignore-X-Frame-headers_v1.1");
    }
    return args;
  });
};
\end{lstlisting}   
\item Add the following to your \lstinline{cypress.json} file
\lstinline{chromeWebSecurity: false}
\item Change the appropriate environment url to use localhost (might be different in your development environment) in the cypress.json file.
\lstinline{test_url: "http://localhost:4200",} 
\item Download the \href{http://chrome.google.com/webstore/detail/ignore-x-frame-headers/gleekbfjekiniecknbkamfmkohkpodhe}{Ignore X-Frame Headers} plugin within Cypress launched browser. Will remain downloaded, even when you end your Cypress session. 
\end{enumerate}

\section{Friendly Reminder}
These four steps are all you will need in order to run Cypress locally. Ideally your organization should have special urls to run your apis in a test environment. If that is the case, do not forget to change them in your environment.ts file. 


