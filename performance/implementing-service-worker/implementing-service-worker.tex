\chapter{ The Angular Service Worker - Implementing in App }

For those of you unaware, a service worker is a a script that runs in the web
browser that manages caching for an application. So let's say you are offline
and you are making a query in your app that you have already made before, then
the service workers will make it so that request can go through even without a
network request. In short, having a servie worker, can increase dependency on a
network, and will greatly increase the user experience.

\section{ Design Goals }
\begin{enumerate}
  \item Caching an application is like installing a native application.
  The application is cached as one unit, and all files update together.
  \item A running application continues to run with the same version of all
  files. It does not suddenly start receiving cached files from a newer version,
  which are likely incompatible.
  \item When users refresh the application, they see the latest fully cached
  version. New tabs load the latest cached code.
  \item Updates happen in the background, relatively quickly after changes are
  published. The previous version of the application is served until an update
  is installed and ready.
  \item The service worker conserves bandwidth when possible. Resources are only
  downloaded if they've changed.
\end{enumerate}

\section{ Manifest File }
To support the above design goals, Angular loads a manifest file. The manifest
describes the resources to cache and includes hashes of every file's contents
\footnote{taken from https://angular.io/guide/service-worker-intro}.

\section{ Using Angular CLI to Enable Service Workers }
In the chapter where we used ng new for the first time, we set it up with a flag
for service workers. [For practical purposes, if you did not use the flag for
creating service workers, use the link \href{https://angular.io/guide/service-worker-getting-started}{here}]
and follow through on the steps in the link. I believe in you! You can do this!

For academic purposes, here is what the service worker flag does:
\begin{enumerate}
  \item Adds the @angular/service-worker package
  \item Sets the Angular Cli serviceWorker option to true, so that it generates
  a manifest for every build
  \item Imports the ServiceWorkerModule, and registers the ngsw-worker.js file,
  which is the name of pre-build service worker script
  \item Creates a ngsw-config.json file, which configures defaults for service
  worker
\end{enumerate}

\section{ Simulating a Network Issue }
\begin{enumerate}
  \item Go to Chrome dev tools \footnote{write something here if person does not know how
  to do so}
  \item Go to the Network tab
  \item Check the Offline box
\end{enumerate}

If you service worker is properly being used, then the page will load normally,
as opposed to the page displaying, "There is no internet connection".

For further reading, by all means read through the documentation on Service
Workers, on the \href{https://angular.io/guide/service-worker-getting-started}{Angular.io}.
I agree, reading their documentation can be a bit bland at times, but it is
really thorough and more than get's the job done. Good job Angular documentation
person, or persons!

\section{ Some other architectural decisions }

\section{ Available and Activated Updates }
There is an SwUpdate service available within app, after importing the
ServiceWorkerModule. It can be used to notify users, for instance, to update
their page(s), when the code they are running is out of date:

\begin{lstlisting}[caption=app.routing.module.ts file]
    updates.activated.subscribe(event => {
      console.log('old version was', event.previous);
      console.log('new version is', event.current);
    });
\end{lstlisting}

\section{ Checking for Updates }
Within the same SwUpdate service, we can also check for updates, and set up a
subscriber of sorts, for instance:
\begin{lstlisting}[caption=app.routing.module.ts file]
  import { interval } from 'rxjs/observable/interval';

  @Injectable()
  export class CheckForUpdateService {

    constructor(updates: SwUpdate) {
      interval(6 * 60 * 60).subscribe(() => updates.checkForUpdate());
    }
  }
\end{lstlisting}
